<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script>
    function upload(file, data){
        let xhr = new XMLHttpRequest();
        xhr.onload=function(){data.Files.push(xhr.response);}
        formData = new FormData();
        console.log(file);
        formData.append('fileupload', file, file.name);
        xhr.open('POST', "/api/imageUpload", false);
        xhr.send(formData);
        console.log("sent");
    }
    function sendData(){
      let data = {"Title":document.getElementById("titleText").value,
              "Description":document.getElementById("descriptionText").value,
              "Location":document.getElementById("locationText").value,
              "Files":[]
             }
      if(document.getElementById("fileInput").value != "")
        {
          let Files = [];
          console.log();
          for(let i = 0; i < document.getElementById("fileInput").files.length; i++){
            upload(document.getElementById("fileInput").files[i], data)

/*
            let file = document.getElementById("fileInput").files[i];
            let reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(srcData){
              let imageClient = new XMLHttpRequest();
              imageClient.open("POST", "http://127.0.0.1/api/imageUpload", true);
              imageClient.setRequestHeader("Content-type", "application/octet-stream");
              //console.log(srcData.target.result.substring(srcData.target.result.indexOf(",")+1));
              console.log(srcData.target.result.substring(srcData.target.result.indexOf(",")+1));
              imageClient.send(srcData.target.result.substring(srcData.target.result.indexOf(",")+1))
            }*/
          }
          //console.log(Files);
          //data.Files = Files;
          console.log(data);
        }
      let tags = [];
      if(document.getElementById("domesticViolenceCheckBox").checked == true)
        tags.push(document.getElementById("domesticViolenceCheckBox").value);
      if(document.getElementById("sexualAssaultCheckBox").checked == true)
        tags.push(document.getElementById("sexualAssaultCheckBox").value);
      if(document.getElementById("childAbuseCheckBox").checked == true)
        tags.push(document.getElementById("childAbuseCheckBox").value);
      data.tags=tags;
      let client = new XMLHttpRequest();
      client.open("POST", "http://127.0.0.1/api/story", true);
      client.setRequestHeader("Content-type", "application/json");
      client.addEventListener("load", function() {
        console.log("ok");
        let newPageClient = new XMLHttpRequest();
        newPageClient.open("Get", "http://127.0.0.1/share/story")
        newPageClient.send();
        //window.location.href="/share/story";
      })
      console.log(data);
      client.send(JSON.stringify(data));
    }
    </script>
    <meta charset="utf-8">
    <title>Anonymously Share Your Story </title>
  </head>
  <body>
    <section>
      <h1>Share Your Story</h1>
      <p>Title of your story</p>
        Title: <br>
       <input type="text" name="Title" id="titleText" placeholder="First user story"><br>
        <br>
        Description: <br>
        <textarea rows="4" cols="50" id="descriptionText" placeholder="Description"></textarea>
        <br><br>
        <table>
          <tr>Upload (Optional)     </tr><tr><input type="file" id="fileInput" name="" multiple></tr>
        </table>
        <br>
        Location: <br>
       <input type="text" name="Location" id="locationText" placeholder="City, State"><br>
       <br><br>
       Add Tags: <br>
       <input type="checkbox" id="domesticViolenceCheckBox" name="case1" value="Domestic Violence"> Domestic Violence
       <br>
       <input type="checkbox" id="sexualAssaultCheckBox" name="case2" value="Sexual Assault"> Sexual Assault
       <br>
       <input type="checkbox" id="childAbuseCheckBox" name="case3" value="Child Abuse"> Child Abuse
       <br>
       <input type="checkbox" id="otherCheckBox" name="case4" value="Other"> Other
       <br>
       <br><br>
     <button onclick="sendData()">submit</button>
    </section>



    <p>Design the skeleton of write story page</p>
  </body>
</html>
